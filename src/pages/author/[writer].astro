---
import BaseLayout from '../../layouts/BaseLayout.astro';
import PostCard from './../../components/PostCard.astro';

export async function getStaticPaths() {
	const allPosts = await Astro.glob('./../posts/*.md');
	const authors = new Set();

	allPosts.forEach((post, id) => {
		allPosts[id].frontmatter.author = post.frontmatter.author
			.replaceAll(' ', '-')
			.toLowerCase();
		authors.add(allPosts[id].frontmatter.author);
	});

	const params = new Array();

	authors.forEach((one) => {
		params.push({ params: { writer: one }, props: { posts: allPosts } });
	});

	return params;
}

const { writer } = Astro.params;
const { posts } = Astro.props;

const filteredPosts = posts.filter((post) => post.frontmatter.author == writer);
---

<BaseLayout>
	<ul class='flex flex-col gap-4 mx-6'>
		<h1 class='text-4xl mb-4'>
			Written by <span class='capitalize font-medium'
				>{writer?.replaceAll('-', ' ')}</span
			>
		</h1>
		{filteredPosts.map((post) => <PostCard {post} />)}
	</ul>
</BaseLayout>
